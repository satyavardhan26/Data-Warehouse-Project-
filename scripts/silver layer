--checking data Qulaity in crm_cust_info table in bronze layer analyzing bronze layer using below sql quries 

Select * From bronze.crm_cust_info;


--CHECK FOR UNWANTED SPACES 

SELECT  cst_firstname 
FROM  bronze.crm_cust_info
WHERE  cst_firstname != TRIM(cst_firstname);


SELECT  cst_lastname 
FROM  bronze.crm_cust_info
WHERE  cst_lastname != TRIM(cst_lastname);

--Data Standardization & consistensy 

Select Distinct cst_gndr
From bronze.crm_cust_info;

Select Distinct cst_material_status
From bronze.crm_cust_info;


--after understanding the quality of the data need to improve the quality for that return below sql query 


INSERT INTO silver.crm_cust_info(
	cust_id,
	cst_key,
	cst_firstname,
	cst_lastname,
	cst_material_status,
	cst_gndr,
	cst_create_date

)
Select 
cust_id,
cst_key,
TRIM(cst_firstname) AS cst_firstname,
TRIM(cst_lastname) AS cst_lastname,
CASE 
	WHEN UPPER(TRIM(cst_material_status)) = 'M' then 'Married'
	WHEN UPPER(TRIM(cst_material_status)) = 'S' then 'Single'
	ELSE 'N/A'
END cst_material_status,
CASE 
	WHEN UPPER(TRIM(cst_gndr)) = 'F' then 'Female'
	WHEN UPPER(TRIM(cst_gndr)) = 'M' then 'male'
	ELSE 'N/A'
END cst_gndr,

cst_create_date
From (
	Select *, ROW_NUMBER() OVER (PARTITION BY cust_id ORDER BY cst_create_date DESC ) as flag_last
	FROM bronze.crm_cust_info
	where cust_id IS NOT NULL 
	)t WHERE flag_last =1 
